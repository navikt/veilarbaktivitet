{
  "$schema": "https://json-schema.org/draft-07/schema",
  "$id": "https://aktivitetskort.nav.no/aktivitetskort_v1.json",
  "title": "AktivitetskortV1 Schema",
  "description": "Kommando-basert grensesnitt for å opprette og endre aktivitetskort i aktivitetsplanen. \nLøsningen er beregnet på team som har data i sine systemer som skal representeres som en aktivitet i aktivitetsplan, for eksempel tiltaksgjennomføringer. ",
  "type": "object",
  "required": [
    "messageId",
    "source",
    "sendt",
    "actionType",
    "payload"
  ],
  "properties": {
    "messageId": {
      "type": "string",
      "format": "uuid",
      "description": "Unik meldingsid på UUID format for kafka meldingen."
    },
    "source": {
      "type": "string",
      "examples": [
        "ARENA_TILTAK_AKTIVITET_ACL"
      ],
      "description": "Opprinnelses kildesystem for meldingen."
    },
    "sendt": {
      "type": "string",
      "format": "date-time",
      "description": "Dato og tidspunkt da meldingen ble produsert."
    },
    "actionType": {
      "type": "string",
      "enum": ["UPSERT_TILTAK_AKTIVITET_V1, UPSERT_UTDANNING_AKTIVITET_V1, UPSERT_GRUPPE_AKTIVITET_V1"],
      "description": "Actiontype gir en instruksjon om hvordan meldingen skal behandles. En aktionType vil typisk være knyttet til hvilken aktivitetstype som skal opprettes eller endres."
    },
    "payload": {
      "$ref": "#/definitions/payload",
      "description": "Payload inneholder selve aktivitetsdataene, og kan være av ulik type avhengig av hvilken aktivitetstype som skal opprettes. Alle aktivitetstyper må inneholde basisfeltene som er felles for alle aktivitetstyper, slik som id, personIdent, tittel, aktivitetStatus, etc. "
    }
  },
  "definitions": {
    "payload": {
      "type": "object",
      "required": [
        "id",
        "personIdent",
        "tittel",
        "aktivitetStatus",
        "startDato",
        "beskrivelse",
        "endretAv",
        "endretTidspunkt",
        "avtaltMedNav"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "Funksjonell ID for aktiviteten er en globalt unik UUID for aktiviteten. Ved vellykket opprettelse av aktiviteten, vil aktiviteten kunne gjenfinnnes ved hjelp av denne iden. Senere modifisering av samme aktivitet vil også bruke denne iden for å identifisere korrekt aktivitet."
        },
        "eksternReferanseId": {
          "type": "string"
        },
        "personIdent": {
          "type": "string",
          "examples": [
            "10068831950"
          ],
          "description": "Norsk identitetsnummer (d-nr eller f-nr) for personen som eier aktivitetskortet"
        },
        "tittel": {
          "type": "string",
          "description": "Tittelen på aktivitetskortet"
        },
        "aktivitetStatus": {
          "type": "string",
          "enum": [
            "PLANLAGT, GJENNOMFORES, FULLFORT, BRUKER_ER_INTERESSERT, AVBRUTT"
          ],
          "description": "Dette feltet forteller hvilken status aktiviteten har, og dermed hvilken kolonne aktivitetskortet skal ligge i i aktivitetsplanen. Merk at aktivitetskort som er fullført eller avbrutt ikke kan endres i etterkant, da dette er en endelig status."
        },
        "startDato": {
          "type": "string",
          "format": "date",
          "examples": [
            "2022-03-01"
          ],
          "description": "Planlagt startdato for aktiviteten"
        },
        "sluttDato": {
          "type": "string",
          "format": "date",
          "examples": [
            "2022-05-15"
          ],
          "description": "Planlagt sluttdato for aktiviteten"
        },
        "beskrivelse": {
          "type": "string",
          "description": "Beskrivende tekst for aktiviteten"
        },
        "endretAv": {
          "type": "object",
          "required": [
            "ident",
            "identType"
          ],
          "description": "Sporingsfelt som identifiserer hvem som oppretter eller endrer aktiviteten",
          "properties": {
            "ident": {
              "type": "string",
              "examples": [
                "Z999999"
              ],
              "description": "Id til bruker som oppretter eller endrer aktiviteten"
            },
            "identType": {
              "type": "string",
              "enum": [
                "arenaIdent"
              ],
              "description": "Type ident. Kan være navIdent, arenaIdent, på sikt kanskje tiltaksarrangør, arbeidsgiver eller eksternBruker"
            }
          },
          "examples": [
            {
              "ident": "AAA123",
              "identType": "arenaIdent"
            }
          ]
        },
        "endretTidspunkt": {
          "type": "string",
          "format": "date-time",
          "examples": [
            "2022-09-17T21:00:14"
          ],
          "description": "Dato-tid for opprettelse eller endring i kildesystemet"
        },
        "avtaltMedNav": {
          "type": "boolean",
          "description": "Hvorvidt aktiviteten skal bli markert som 'Avtalt med NAV'. Dette gjelder typisk aktiviteter med aktivitetsplikt."
        }
      },
      "oneOf": [
        { "$ref": "#/definitions/tiltakAktivitet" },
        { "$ref": "#/definitions/utdanningsAktivitet" },
        { "$ref": "#/definitions/gruppeAktivitet" }
      ]
    },
    "tiltakAktivitet": {
      "type": "object",
      "required": [
        "tiltaksKode",
        "tiltaksNavn",
        "arrangorNavn"
      ],
      "properties": {
        "tiltaksKode": {
          "type": "string",
          "examples": [
            "MIDLONTIL"
          ],
          "description": "Kodeverksverdi for tiltakstypen. Denne verdien kommer fra domenet som eier tiltakstypene. Aktivitetsplan kan ha behov for å kjenne til mulige kodeverksverdier her for å kunne tilpasse visningen for ulike tiltakstyper."
        },
        "tiltaksNavn": {
          "type": "string",
          "examples": [
            "Midlertidig lønnstilskudd"
          ],
          "description": "Navnet på tiltaket"
        },
        "deltakelseStatus": {
          "type": "string",
          "description": "DeltakelseStatus/avtaleStatus/gjennomføringsStatus sier hvilken status tiltaksgjennomføringen har for den aktuelle brukeren. Gyldige verdier i dette feltet vil avhenge av hvilken tiltakstype det gjelder. Aktivitetsplan må kjenne til mulige verdier for denne koden for å kunne tilpasse visningen av aktivitetskortet.  "
        },
        "arrangorNavn": {
          "type": "string",
          "examples": [
            "NAV BÆRUM"
          ],
          "description": "Navn på arrangøren av tiltaket."
        },
        "detaljer": {
          "type": "object",
          "additionalProperties": { "type": "string" },
          "description": "For å vise selvdefinerte informasjonsfelter på aktivitetskortet",
          "examples": [
            {
              "deltakelseProsent": "100",
              "dagerPerUke": "5"
            }
          ]
        }
      }
    }
  },
  "examples": [
    {
      "messageId": "329102a1-6253-4324-8b2b-c2da379055c0",
      "source": "DAB",
      "sendt": "2022-09-24T00:00:00.55555555",
      "actionType": "UPSERT_TILTAK_AKTIVITET_V1",
      "payload": {
        "id": "f9820d83-0674-4df6-8d25-4322af86fbe0",
        "eksternReferanseId": 1234567,
        "personIdent": "12345678999",
        "tittel": "Tiltak hos NAV Bærum",
        "aktivitetStatus": "FULLFORT",
        "startDato": "2022-04-01",
        "sluttDato": "2022-06-30",
        "beskrivelse": "beskrivelse",
        "endretAv": {
          "identType": "arenaIdent",
          "ident": "AAA0000"
        },
        "endretTidspunkt": "2022-09-17T21:00:00",
        "avtaltMedNav": true,
        "tiltaksKode": "MIDLONTIL",
        "tiltaksNavn": "Midlertidig lønnstilskudd",
        "deltakelseStatus": "FATT_PLASS",
        "arrangorNavn": "NAV BÆRUM",
        "detaljer": {
          "deltakelseProsent": "80",
          "dagerPerUke": "4"
        }
      }
    }
  ]
}



