asyncapi: 2.5.0
info:
  title: Aktiviteskort as a service
  description: |
    Kommando-basert grensesnitt for å opprette og endre aktivitetskort i aktivitetsplanen.
    Løsningen er beregnet på team som har data i sine systemer som skal representeres som en aktivitet i aktivitetsplan.
    For eksempel tiltaksgjennomføringer.
  version: '0.0.1'

defaultContentType: application/json

channels:
  aktivitet-v1:
    description: Toppic for å bestille eller oppdatere aktiviteter i aktivitsplan
    publish:
      traits:
        - $ref: '#/components/operationTraits/kafka'
      message:
        $ref: '#/components/messages/aktivitetskort'


components:
  messages:
    aktivitetskort:
      name: aktivitetskortBestilling
      title: Aktivitetskort bestilling
      summary: Bestilling for oppretting eller endring av et aktivitetskort
      contentType: application/json
      traits:
        - $ref: '#/components/messageTraits/commonHeaders'
      payload:
        $ref: "#/components/schemas/aktivitetskort-bestilling"
  messageTraits:
    commonHeaders:
      headers:
        required:
          - call-id
        type: object
        properties:
          call-id:
            type: string
            minLength: 10
            description: brukes for logging

  schemas:
    aktivitetskort-bestilling:
      required:
        - messageId
        - source
        - sendt
        - aktivitetskortType
        - aktiviteskort
        - actionType
      type: object
      properties:
        messageId:
          type: string
          format: uuid
        source:
          type: string
          description: Aplikasjonen som bestiller sin tildelte id.
        sendt:
          type: string
          format: date-time
        aktivitetskortType:
          $ref: "#/components/schemas/aktivitetskortType"
        actionType:
          $ref: "#/components/schemas/actionType"
        aktiviteskort:
          $ref: "#/components/schemas/aktivitetskort"

    actionType:
      type: string
      enum:
        - UPSERT_AKTIVITETSKORT_V1
      description: Actiontype gir en instruksjon om hvordan meldingen skal behandles.
        En aktionType vil typisk være knyttet til hvilken aktivitetstype som skal opprettes
        eller endres.
    aktivitetskortType:
      type: string
      enum:
        - MIDLERTIDIG_LONNSTILSKUDD
        - VARIG_LONNSTILSKUDD
        - ARENA_TILTAK
    oppgave:
      type:
        - object
        - 'null'
      properties:
        tekst:
          type: string
        subtekst:
          type: string
        url:
          type: string
          format: url
    lenkeseksjon:
      type: object
      properties:
        tekst:
          type: string
        subtekst:
          type: string
        url:
          type: string
          format: url
        lenkeType:
          type: string
          enum:
            - EKSTERN
            - INTERN
            - FELLES
    attributt:
      type: object
      properties:
        label:
          type: string
        verdi:
          type: string
    aktivitetskort:
      type: object
      required:
        - id
        - personIdent
        - tittel
        - aktivitetStatus
        - endretAv
        - endretTidspunkt
        - avtaltMedNav
      properties:
        id:
          type: string
          format: uuid
          description: Funksjonell ID for aktiviteten er en globalt unik UUID for aktiviteten.
            Ved vellykket opprettelse av aktiviteten, vil aktiviteten kunne gjenfinnnes
            ved hjelp av denne iden. Senere modifisering av samme aktivitet vil også
            bruke denne iden for å identifisere korrekt aktivitet.
        personIdent:
          type: string
          examples:
            - '10068831950'
          description: Norsk identitetsnummer (d-nr eller f-nr) for personen som eier
            aktivitetskortet
        tittel:
          type: string
          description: Tittelen på aktivitetskortet
        aktivitetStatus:
          type: string
          enum:
            - FORSLAG
            - PLANLAGT
            - GJENNOMFORES
            - FULLFORT
            - AVBRUTT
          description: Dette feltet forteller hvilken status aktiviteten har, og dermed
            hvilken kolonne aktivitetskortet skal ligge i i aktivitetsplanen. Merk at
            aktivitetskort som er fullført eller avbrutt ikke kan endres i etterkant,
            da dette er en endelig status.
        startDato:
          type:
            - string
            - 'null'
          format: date
          examples:
            - '2022-03-01'
          description: Planlagt startdato for aktiviteten
        sluttDato:
          type:
            - string
            - 'null'
          format: date
          examples:
            - '2022-05-15'
          description: Planlagt sluttdato for aktiviteten
        beskrivelse:
          type:
            - string
            - 'null'
          description: Beskrivende tekst for aktiviteten
        endretAv:
          type: object
          required:
            - ident
            - identType
          description: Sporingsfelt som identifiserer hvem som oppretter eller endrer
            aktiviteten
          properties:
            ident:
              type: string
              examples:
                - Z999999
              description: Id til bruker som oppretter eller endrer aktiviteten
            identType:
              type: string
              enum:
                - ARENAIDENT
                - NAVIDENT
                - PERSONBRUKER
              description: Type ident. Kan være navIdent, arenaIdent, på sikt kanskje
                tiltaksarrangør, arbeidsgiver eller eksternBruker
          examples:
            - ident: AAA123
              identType: ARENAIDENT
        endretTidspunkt:
          type: string
          format: date-time
          examples:
            - '2022-09-17T21:00:14'
          description: Dato-tid for opprettelse eller endring i kildesystemet
        avtaltMedNav:
          type: boolean
          description: Hvorvidt aktiviteten skal bli markert som 'Avtalt med NAV'. Dette
            gjelder typisk aktiviteter med aktivitetsplikt.
        avsluttetBegrunnelse:
          type:
            - string
            - 'null'
          description: Ved avbrudd i aktiviteten, kan det legges til en begrunnelse
            for avbrytelsen.
        oppgaver:
          type:
            - object
            - 'null'
          properties:
            ekstern:
              "$ref": "#/components/schemas/oppgave"
            intern:
              "$ref": "#/components/schemas/oppgave"
        handlinger:
          type:
            - array
            - 'null'
          items:
            "$ref": "#/components/schemas/lenkeseksjon"
        detaljer:
          type: array
          items:
            "$ref": "#/components/schemas/attributt"
          description: For å vise selvdefinerte informasjonsfelter på aktivitetskortet
        etiketter:
          type: array
          items:
            type: object
            properties:
              kode:
                type: string
          description: Enum/koder som mappes om til noe tekst basert på aktivitetskorttypen

  operationTraits:
    kafka:
      bindings:
        kafka:
          key:
            type: string
            format: uuid
            description: aktiviteskorts id. Også kalt funksjonell id
